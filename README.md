# 面试题总结
  # 1.linux运行级别
    运行级别0：关机
    运行级别1：单用户模式
    运行级别2：多用户文本状态(没有NFS)
    运行级别3：多用户文本模式(有NFS)
    运行级别4：系统未使用，保留
    运行级别5：图形模式
    运行级别6：重启
  # 2.linux启动过程
    加电自检，根据bios设定查找主引导记录来加载grub,然后根据grub加载指定的kernel，kernel加载驱动，
    挂在rootfs，初始化第一个init（centos7为systemd）进程，init进程根据设定的运行级别运行和停止相关的服务，之后启动终端等待用户登陆。
    开机加电BIOS自检—–>MBR引导—–>grub引导菜单—–>加载内核—–>启动init进程———–>读取inittab文件—–>启动mingetty进程———–>登录系统
  # 3.dns解析过程
    1.检查本地hosts文件是否有记录，没有的话向指定的dns服务器发起请求（递归查询）
    2.dns服务器收到请求后先检查一下自己的缓存中有没有这个地址，有的话就直接返回，没有的话则向13个根域名服务器其中一台发起请求
    3.根域名服务器收到请求后，返回com域的ns服务器地址
    4.dns服务器向com域的ns服务器发起请求，com域的ns服务器返回baidu.com的NS服务器地址
    5.dns服务器向baidu.com服务器发起请求，baidu.com服务器返回www.baidu.com的ip地址
    6.dns服务器向客户端返回www.baidu.com的ip地址
  # 4.用户反映你开发的网站访问很慢可能会是什么原因
    1.服务器出口带宽不够用
    2.服务器负载过大忙不过来，比如说CPU和内存消耗完了
    3.网站的开发代码没写好，例如mysql语句没有进行优化
    4.数据库的瓶颈
    针对上面可能的原因，有哪些方法和工具去检测：
    1.首先你自己也打开下网站，看是否会出现用户反映的问题，如果你这边访问没问题，
      那就可能是用户那边的问题了，这块就是要先确定是用户那一方的问题还是自身比如说服务器或者网站的问题
    2.如果是服务器的问题，那么可以利用浏览器的调试功能,调试网络看看各种数据加载的速度，
      哪一项消耗了多少时间都可以看到，是哪块数据耗时过多，是图片加载太慢，还是某些数据加载老半天都查不出来
    3.然后针对服务器的负载情况，可以去查看下服务器硬件（网络带宽、CPU、内存）的消耗状况
    4.如果服务器负载正常的话，那要去看看是不是程序的问题了。这个可以通过查日志来找，比如PHP日志、Apache日志、
      mysql日志等等的错误日志，特别如mysql有个慢查询的日志功能，可以看到是不是某条mysql语句特别慢，
      如果某条语句花的时间太长，那这条语句很有可能有问题。
    5.至于说到的数据库太庞大，这个直接看就看得到了，比如一个表的文件大小变得特别大了
    针对上面的这些问题，有哪些解决和优化的办法：
    1.出口带宽的问题，这个很简单，加带宽，有钱就多买带宽，很简单
    2.mysql语句优化，开发人员职责
    3.数据库太庞大，为了读写速度，进行“拆表”、“拆库”，就是把数据表或者数据库进行拆分
    4.使用缓存机制，把数据缓存到了内存，用户访问数据直接从内存读取，读取速度就比在磁盘中读取快了很多
    5.CDN（content-delivery-network：内容分发网络）
    6.到架构的优化
  # 5.mysql备份方法
    直接cp,tar复制数据库文件
    mysqldump+复制BIN LOGS
    lvm2快照+复制BIN LOGS
    xtrabackup
  # 6.删除一个目录下的所有文件，但保留一个指定文件
    find /xx -type f ! -name "file10" -exec rm -f {} \;
  # 7.iptables: https://idc.wanyunshuju.com/yunwei/571.html
  # 8.如果一台办公室内主机无法上网(打不开网站)，请给出你的排查步骤
    首先确定物理链路是否联通正常。
    查看本机IP，路由，DNS的设置情况是否达标。
    ping一下网关，进行最基础的检查，ping公网ip，通了，表示能够到达服务器。
    测试DNS的通畅。ping出对应IP。
    telnet检查服务器的WEB有没有开启以及防火墙是否阻拦。
  # 9.三次握手和四次挥手
    1. 连接开始时，连接建立方(Client)发送SYN包，并包含了自己的初始序号a；
    2. 连接接受方(Server)收到SYN包以后会回复一个SYN包，其中包含了对上一个a包的回应信息ACK，回应的序号为下一个希望收到包的序号，
       即a＋1，然后还包含了自己的初始序号b；
    3. 连接建立方(Client)收到回应的SYN包以后，回复一个ACK包做响应，其中包含了下一个希望收到包的序号即b＋1。
    1. 首先进行关闭的一方（即发送第一个FIN）将执行主动关闭，而另一方（收到这个FIN）执行被动关闭。
    2. 当服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。
    3. 同时TCP服务器还向应用程序（即丢弃服务器）传送一个文件结束符。接着这个服务器程序就关闭它的连接，导致它的TCP端发送一个FIN。
    4. 客户必须发回一个确认，并将确认序号设置为收到序号加1。
  # 10.将本地的80端口的请求转发到8080端口，本机地址10.0.0.254，写出命令
      iptables -t nat -A PREROUTING -d 10.0.0.254 -p tcp –dprot 80 -j DNAT --to-destination 10.0.0.254:8080
  # 11.请描述OSI7层模型各层名字及功能，并举例在不同层对应的协议
    第一层：物理层，利用传输介质为数据提供物理连接， 对应的协议：ARP
    第二层：数据链路层：建立和管理各节点间的链接链路 对应的协议：PPTP、CDP
    第三层：网络层，是控制数据链路层与上传输层之间的信息转发、建立与维持对应的协议：IP、路由协议
    第四层：传输层，提供会话传输服务，确保数据正确传送对应的协议：TCP UDP
    第五层：会话层，提供建立会话管理，支持数据交换
    第六层：表示层，处理数据(数据格式、编码、加密等)，按一定的格式传送至会话层
    第七层：应用层，为用户提供各类应用服务(文件、打印、邮件等服务)对应协议：HTTP、FTP、SMTP、POP3
  # 12.linux系统中添加路由的方法
      主机路由
      route add -host 192.168.197.100 dev eth0
      网关路由
      route add default gw 192.168.197.1
      网络路由
      route ad -net 192.168.1.0 netmask 255.255.255.0 dev eth1
      route ad -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.197.1
  # 13.Nginx、HAProxy、LVS三者的优缺点
    Nginx优点：
    1.工作在网络7层之上，支持正则，可针对http应用做一些分流的策略，如针对域名、目录结构，它的正规规则比HAProxy更为强大和灵活
    2.Nginx对网络稳定性的依赖非常小，理论上能ping通就能进行负载功能
    3.Nginx安装与配置比较简单，测试也比较方便，基本能把错误日志打印出来
    4.可以承担高负载压力且稳定，硬件不差的情况下一般能支撑几万次的并发量，负载度比LVS小
    5.Nginx可以通过端口检测到服务器内部的故障
    Nginx缺点:
    1.适应范围较小，仅能支持http、https、Email协议
    2.对后端服务器的健康检查，只支持通过端口检测，不支持url来检测
    LVS优点:
    1.抗负载能力强，工作在网络4层之上仅作分发之用，没有流量的产生，这个特点也决定了它在负载均衡软件里的性能最强的，
      对内存和cpu资源消耗比较低
    2.配置性比较低，这是一个缺点也是一个优点，因为没有可太多配置的东西，所以并不需要太多接触，大大减少了人为出错的几率
    3.工作稳定，因为其本身抗负载能力很强，自身有完整的双机热备方案，如LVS+Keepalived，
      不过我们在项目实施中用得最多的还是LVS/DR+Keepalived
    4.无流量，LVS只分发请求，而流量并不从它本身出去，这点保证了均衡器IO的性能不会收到大流量的影响
    5.应用范围比较广，因为LVS工作在4层，所以它几乎可以对所有应用做负载均衡，包括http、数据库
    LVS缺点:
    1.软件本身不支持正则表达式处理，不能做动静分离
    HAProxy优点:
    1.HAProxy工作在4、7层,支持TCP协议的负载均衡转发,支持虚拟主机
    2.HAProxy支持Session的保持，Cookie的引导；同时支持通过获取指定的url来检测后端服务器的状态。
    3.HAProxy跟LVS类似，本身就只是一款负载均衡软件；单纯从效率上来讲HAProxy会比Nginx有更出色的负载均衡速度，
      在并发处理上也是优于Nginx的。
    HAProxy缺点:
    1.不支持POP/SMTP协议
    2. 不支持HTTP cache功能
    3.重载配置的功能需要重启进程
    4.多进程模式支持不够好
  # 14.如何实现 Nginx 代理的节点访问日志记录客户的 IP 而不是代理的 IP
    在nginx代理文件中怎加一行配置文件：proxy_set_header  X-Real-IP $remote_addr;
  # 15.raid 0 1 5 10
    RAID 0 又称为Stripe（条带化）或striping(条带模式)，它在所有RAID级别中具有最高的存储性能（磁盘容量不浪费，读写很快）
    RAID0 提高存储性能的原理是把连续的数据分散到多个磁盘上存取，这样，系统有数据请求就可以被多个磁盘并行的执行，
    每个磁盘执行属于它自己的那部分数据请求，这种数据上的并行操作可以充分利用总线的带宽，显著提高磁盘整体存取性能。
    RAID 1 又称为Mirror 或Mirrooring(镜像)，它的宗旨是最大限度的保证用户数据的可用性和可修复性，
    RAID 1 的操作方式是把用户写入硬盘的数据百分之百的自动复制到另外一个硬盘上，从而实现存储双份的数据。
    RAID 5需要三块或以上的物理磁盘，可以提供热备盘实现故障恢复，采用奇偶校验，可靠性强，
    只有同时损坏2块盘时数据才会损坏，只损坏1块盘时，系统会根据存储的奇偶校验位重建数据，
    临时提供服务，此时如果有热备盘，系统还会自动在热备盘上重建故障磁盘上的数据
    RAID 1+0 也被称为RAID 10标准，实际是将RAID 1和RAID 0标准结合的产物，在连续地以位或字节为单位分割数据并且并行读/写多个磁盘的同时，
    为每一块磁盘作磁盘镜像进行冗余。它的优点是同时拥有RAID 0的超凡速度和RAID 1的数据高可靠性，但是CPU占用率同样也更高，而且磁盘的利用率比较低。
  # 16.apache工作模式
    1.Prefork: 多进程模式
    2.worker: 多进程多线程模式
  # 17.讲一下Keepalived的工作原理
    在一个虚拟路由器中，只有作为MASTER的VRRP路由器会一直发送VRRP通告信息,BACKUP不会抢占MASTER，
    除非它的优先级更高。当MASTER不可用时(BACKUP收不到通告信息)多台BACKUP中优先级最高的这台会被抢占为MASTER。
    这种抢占是非常快速的(<1s)，以保证服务的连续性,由于安全性考虑，VRRP包使用了加密协议进行加密。BACKUP不会发送通告信息，只会接收通告信息
  # 18.常用的nginx模块
    rewrite模块，实现重写功能
    access模块：来源控制
    ssl模块：安全加密
    ngx_http_gzip_module：网络传输压缩模块
    ngx_http_proxy_module 模块实现代理
    ngx_http_upstream_module模块实现定义后端服务器列表
    ngx_cache_purge实现缓存清除功能
  # 19.查看http的并发请求数与其TCP连接状态
    netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}'
  # 20.随机数产生
    head  /dev/urandom  |  tr -dc A-Za-z0-9 | head -c 8
  # 21.如何用tcpdump嗅探80端口的访问看看谁最高
    tcpdump -i eth0 -tnn dst port 80 -c 1000 | awk -F"." '{print $1"."$2"."$3"."$4"."}' | sort |uniq -c | sort -nr | head-5
  # 22.如何查看Linux系统每个ip的连接数
    netstat -n | awk '/^tcp/{print $5}' | awk -F: '{print $1}' | uniq -c | sort -nr
  # 23.ps aux 中的VSZ代表什么意思，RSS代表什么意思
    VSZ:虚拟内存集,进程占用的虚拟内存空间
    RSS:物理内存集,进程战用实际物理内存空间
